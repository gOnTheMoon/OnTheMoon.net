<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>2. Fractal processing server example - part 1 - On the moon</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="זלינגר"><meta name=description content="Today I want to discuss a simple example for a notification server, which is often given as a first exercise for developers new to the framework. This will be a variation of the usual exercise, so I can demonstrate some of the core concepts. The notification server we want to implement today is a server that generates pictures of fractals. For those of you who are not familiar with fractals, these are mathematical shapes with self-symmetry."><meta name=generator content="Hugo 0.71.1 with theme even"><link rel=canonical href=http://onthemoon.net/post/2020-07-15/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="2. Fractal processing server example - part 1"><meta property="og:description" content="Today I want to discuss a simple example for a notification server, which is often given as a first exercise for developers new to the framework. This will be a variation of the usual exercise, so I can demonstrate some of the core concepts. The notification server we want to implement today is a server that generates pictures of fractals. For those of you who are not familiar with fractals, these are mathematical shapes with self-symmetry."><meta property="og:type" content="article"><meta property="og:url" content="http://onthemoon.net/post/2020-07-15/"><meta property="article:published_time" content="2020-07-15T20:37:55-04:00"><meta property="article:modified_time" content="2020-07-15T20:37:55-04:00"><meta itemprop=name content="2. Fractal processing server example - part 1"><meta itemprop=description content="Today I want to discuss a simple example for a notification server, which is often given as a first exercise for developers new to the framework. This will be a variation of the usual exercise, so I can demonstrate some of the core concepts. The notification server we want to implement today is a server that generates pictures of fractals. For those of you who are not familiar with fractals, these are mathematical shapes with self-symmetry."><meta itemprop=datePublished content="2020-07-15T20:37:55-04:00"><meta itemprop=dateModified content="2020-07-15T20:37:55-04:00"><meta itemprop=wordCount content="1014"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="2. Fractal processing server example - part 1"><meta name=twitter:description content="Today I want to discuss a simple example for a notification server, which is often given as a first exercise for developers new to the framework. This will be a variation of the usual exercise, so I can demonstrate some of the core concepts. The notification server we want to implement today is a server that generates pictures of fractals. For those of you who are not familiar with fractals, these are mathematical shapes with self-symmetry."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>On the moon</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>On the moon</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>2. Fractal processing server example - part 1</h1><div class=post-meta><span class=post-time>2020-07-15</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents></nav></div></div><div class=post-content><p>Today I want to discuss a simple example for a notification server, which is often given as a first exercise for developers new to the framework. This will be a variation of the usual exercise, so I can demonstrate some of the core concepts.
The notification server we want to implement today is a server that generates pictures of fractals. For those of you who are not familiar with <a href=https://en.wikipedia.org/wiki/Fractal>fractals</a>, these are mathematical shapes with self-symmetry. Some classic examples are <a href=https://en.wikipedia.org/wiki/Koch_snowflake>Koch’s snowflake</a> and <a href=https://en.wikipedia.org/wiki/Sierpinski_triangle>Sierpinski’s triangle</a>. We will be interested in more complicated fractals that are produced by using complex numbers and give rise to pretty pictures. The fractals our server will be producing are <a href=https://en.wikipedia.org/wiki/Mandelbrot_set>Mandelbrot</a> and <a href=https://en.wikipedia.org/wiki/Julia_set>Julia</a> sets.</p><p>Our notification server will receive requests for fractal images. These requests will contain parameters relevant to the computations needed to be performed. Each request will also contain the width and height of the produced image and a file path to which the produced image should be saved.</p><p>The way we create a fractal image is using the following idea: we translate each pixel of the image to some point in the plane. We think about this point as a complex number. Then we run some iterative process on the complex number, which results with an integer that represents how many iterations of the process were done. We convert this integer into an RGB color and use that for the color of our pixel.</p><p>There are many ways to model this as a notification server, and I will show only one. The proposed structure is as follows:
<img src=/post/images/ProcessingServer.svg alt></p><p>Let us describe each component in this diagram:</p><ul><li>RequestListener - some listener that produces events when a user requests an image. We do not specify how this happens: for instance, changes to a folder in the file system might trigger this to happen. Alternatively, an HTTP request might trigger this. The produced events contain data regarding the computation needed to be performed. They also include the dimensions of the output image (its width and height in pixels) and the file path to which the produced image should be saved.</li><li>PixelGeneratorLogic - receives requests from the listener. For each such request, and for each pixel of the image, it produces an event the pixel. Every pixel event keeps track of the request event as one of its properties. The request event will be used in the next logics and is necessary in order to make it possible later to relate the pixel with the request.</li><li>PixelToComplexConvertLogic – receives a pixel event from the above described logic. Converts this pixel to a complex number, based on the pixel’s coordinates and based on the request event&rsquo;s parameters. Produces an event that contains the pixel information and contains in addition the computed complex number.</li><li>MandelbrotLogic/JuliaLogic - receives an event of a pixel with its computed complex number. Runs an iterative computation which eventually terminates. This computation uses parameters specified in the request event. Produces an event containing the pixel information and the number of iterations performed in the computation.</li><li>ColorConvertLogic - receives an event of a pixel with the number of iterations performed on it. Converts the number of iterations to an RGB color. Produces an event with the pixel information and the computed color.</li><li>PixelStoreLogic - receives request events from the listener. For each such event, allocates an event representing the computed image, is kept in this logic&rsquo;s memory. It also receives events of pixels with computed colors from the ColorConvertLogic. Each such pixel is stored in the big event representing the request’s computed image mentioned before. When all pixels are received, this logic publishes the request’s complete computed image event, and clears this event from its storage. The produced event also contains the request information.</li><li>BitmapConvertLogc - receives completed image events, and produces an event containing a bitmap object representing the image and containing the request details.</li><li>FileSystemDispatcher - receives an event with a bitmap object, and saves it to the file system, according to the path specified in the request.</li></ul><p>I want to make some remarks: A core principle of the notification server architecture is that components do not know each other directly. They receive events and produce events, but that is the only way they can interact. They do not have access to each other’s class instance, they don&rsquo;t know the class type of one another, etc. This allows one to change a component implementation, without having to change the components linking or linked to it. One might even split a component into a chain of multiple components, and this will work as long as the chain receives as input and produces as output the same input and output as the original component.</p><p>Another thing is that many of the components here are <em>stateless</em>: they do not maintain any state, they just run some computations on the received events. These include all components except for the PixelStoreLogic, as it stores the computed pixels until all of them have been computed. The listener and the dispatcher are also not exactly stateless: they do not maintain any data, but they do interact with external resources, such as the file system, and therefore they are not considered strictly stateless. Stateless components are important because they scale.</p><p>A final remark is that both MandelbrotLogic and JuliaLogic are connected to the PixelToComplexConvertLogic. But we are not interested in performing both computations to all pixels. The computation we choose should be based on a parameter in the request event. In order to address this, the notification server introduces a concept called a <strong>rule</strong>. A <strong>rule</strong> is a mechanism that filters events according to, well, some rule. The notification server allows us to specify a rule for each link between components. In our case, we can put a rule that filters only Mandelbrot request types between the MandelbrotLogic and the PixelToComplexConvertLogic, and a similar rule for the JuliaLogic.</p><p>Next time we will explore how a (partial) implementation of this example should look like codewise. This will allow us to discuss the code structure of the notification server.</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>זלינגר</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-07-15</span></p></div><footer class=post-footer><nav class=post-nav><a class=next href=/post/2020-07-11/><span class="next-text nav-default">1. The notification server</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=http://onthemoon.net/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2020
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>זלינגר</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js></script></body></html>